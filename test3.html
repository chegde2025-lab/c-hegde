<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Claim Event Sequence Flow Diagram</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 40px;
    background-color: #f4f6f9;
}

h1 {
    text-align: center;
    color: #1f3c88;
}

.section {
    background: white;
    padding: 25px;
    margin-bottom: 40px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.flow-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.box {
    background-color: #e8f0ff;
    border: 2px solid #1f3c88;
    border-radius: 8px;
    padding: 15px 25px;
    margin: 10px 0;
    width: 300px;
    text-align: center;
    font-weight: bold;
}

.arrow {
    font-size: 28px;
    color: #1f3c88;
}

.note {
    background: #fff4e6;
    padding: 10px;
    margin-top: 15px;
    border-left: 4px solid #ff9800;
}

</style>

<!-- Mermaid CDN -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({ startOnLoad: true });
</script>

</head>

<body>

<h1>Vehicle Insurance Claim Event Flow</h1>

<div class="section">
<h2>Sequential Event Flow Diagram</h2>

<div class="flow-container">

<div class="box">Claim Created</div>
<div class="arrow">↓</div>

<div class="box">contactRoleChanged<br>(Add Insured / Claimant / Attorney)</div>
<div class="arrow">↓</div>

<div class="box">claimChanged<br>(Update Loss Details / Coverage)</div>
<div class="arrow">↓</div>

<div class="box">claimStatusChanged → OPEN</div>
<div class="arrow">↓</div>

<div class="box">reserveChanged<br>(Initial Reserve Set)</div>
<div class="arrow">↓</div>

<div class="box">paymentChanged<br>(Partial Payment Issued)</div>
<div class="arrow">↓</div>

<div class="box">reserveChanged<br>(Increase / Decrease Reserve)</div>
<div class="arrow">↓</div>

<div class="box">paymentChanged<br>(Final Settlement)</div>
<div class="arrow">↓</div>

<div class="box">claimStatusChanged → CLOSED</div>
<div class="arrow">↓</div>

<div class="box">reserveChanged<br>(Release Remaining Reserve)</div>

</div>

<div class="note">
Important Rule: Payment amount must not exceed available reserve.
</div>

</div>

<div class="section">
<h2>Mermaid Diagram (Advanced Rendering)</h2>

<div class="mermaid">
flowchart TD
A[Claim Created] --> B[contactRoleChanged<br>Add Insured/Claimant/Attorney]
B --> C[claimChanged<br>Update Loss Details]
C --> D[claimStatusChanged<br>Status = Open]
D --> E[reserveChanged<br>Initial Reserve Set]
E --> F[paymentChanged<br>Partial Payment]
F --> G[reserveChanged<br>Reserve Adjusted]
G --> H[paymentChanged<br>Final Settlement]
H --> I[claimStatusChanged<br>Status = Closed]
I --> J[reserveChanged<br>Release Remaining Reserve]
</div>

</div>

<div class="section">
<h2>Event Dependency Logic</h2>

<ul>
<li><strong>contactRoleChanged</strong> requires Claim to exist</li>
<li><strong>claimChanged</strong> updates core claim data</li>
<li><strong>claimStatusChanged</strong> reflects lifecycle state</li>
<li><strong>reserveChanged</strong> impacts financial reporting</li>
<li><strong>paymentChanged</strong> triggers accounting and ledger entries</li>
</ul>

<div class="note">
Safe Processing Order: Update Data → Persist → Publish Events → Notify External Systems
</div>

</div>

</body>
</html>
