<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ClaimChangeSet Documentation with Calculation Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f4f6f9;
            line-height: 1.6;
        }
        h1, h2, h3 {
            color: #1f4e79;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
        }
        .highlight {
            background-color: #eef5ff;
            padding: 12px;
            border-left: 5px solid #1f4e79;
        }
        pre {
            background-color: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th {
            background-color: #1f4e79;
            color: white;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        ul {
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">

<h1>ClaimChangeSet – Detailed Documentation with Calculation Logic</h1>

<div class="section">
<h2>1. Overview</h2>
<div class="highlight">
ClaimChangeSet is a transaction-level grouping of all changes made 
to claim-related entities such as claim, exposure, reserve, payment, 
policy, and transaction tables. It is used for audit tracking, 
integration, versioning, and event publishing.
</div>
</div>

<div class="section">
<h2>2. Source Tables</h2>
<ul>
    <li>claim</li>
    <li>policy</li>
    <li>exposure</li>
    <li>transaction</li>
    <li>reserve</li>
    <li>payment</li>
</ul>
</div>

<div class="section">
<h2>3. ClaimChangeSet Table Design</h2>

<h3>Header Table</h3>
<pre>
CREATE TABLE claim_change_set (
    change_set_id     NUMBER PRIMARY KEY,
    claim_id          NUMBER NOT NULL,
    transaction_id    NUMBER,
    event_type        VARCHAR2(50),
    changed_by        VARCHAR2(100),
    change_timestamp  DATE DEFAULT SYSDATE,
    version_number    NUMBER
);
</pre>

<h3>Detail Table</h3>
<pre>
CREATE TABLE claim_change_detail (
    change_detail_id  NUMBER PRIMARY KEY,
    change_set_id     NUMBER NOT NULL,
    entity_name       VARCHAR2(50),
    entity_id         NUMBER,
    field_name        VARCHAR2(100),
    old_value         VARCHAR2(4000),
    new_value         VARCHAR2(4000),
    FOREIGN KEY (change_set_id)
        REFERENCES claim_change_set(change_set_id)
);
</pre>

</div>

<div class="section">
<h2>4. Change Detection Logic</h2>

<pre>
1. Fetch OLD data
2. Apply update
3. Compare OLD vs NEW values
4. Capture only changed fields
5. Insert header + detail records
6. Commit transaction
</pre>

Example comparison logic:
<pre>
IF old_status != new_status THEN
   insert change_detail record
END IF;
</pre>

</div>

<div class="section">
<h2>5. Financial Calculations Captured in ClaimChangeSet</h2>

<h3>Reserve Change Calculation</h3>
<pre>
Reserve Change = New Reserve Amount - Old Reserve Amount
</pre>

Example:
<pre>
Old Reserve = 80,000
New Reserve = 90,000
Reserve Change = +10,000
</pre>

<h3>Payment Change Calculation</h3>
<pre>
Payment Change = Issued Payment Amount
</pre>

<h3>Outstanding Calculation</h3>
<pre>
Outstanding = Total Reserve - Total Paid
</pre>

<h3>Net Incurred Calculation</h3>
<pre>
Net Incurred = Total Paid + Outstanding
</pre>

</div>

<div class="section">
<h2>6. Example Scenario</h2>

<table>
<tr>
    <th>Entity</th>
    <th>Field</th>
    <th>Old Value</th>
    <th>New Value</th>
</tr>
<tr>
    <td>CLAIM</td>
    <td>Status</td>
    <td>OPEN</td>
    <td>CLOSED</td>
</tr>
<tr>
    <td>RESERVE</td>
    <td>Amount</td>
    <td>80,000</td>
    <td>90,000</td>
</tr>
<tr>
    <td>PAYMENT</td>
    <td>Created</td>
    <td>NULL</td>
    <td>50,000</td>
</tr>
</table>

Financial Impact:
<pre>
Total Reserve = 90,000
Total Paid = 50,000
Outstanding = 40,000
Net Incurred = 90,000
</pre>

</div>

<div class="section">
<h2>7. Versioning Strategy</h2>

<pre>
ALTER TABLE claim ADD version_number NUMBER;
</pre>

Each update:
<pre>
version_number = version_number + 1
</pre>

Benefits:
<ul>
    <li>Full claim history</li>
    <li>Event replay capability</li>
    <li>Microservice synchronization</li>
</ul>

</div>

<div class="section">
<h2>8. End-to-End Flow</h2>

<pre>
User Updates Claim
        ↓
System Fetches OLD Data
        ↓
Apply Changes
        ↓
Calculate Financial Impact
        ↓
Detect Changed Fields
        ↓
Create ClaimChangeSet Header
        ↓
Insert Detail Records
        ↓
Commit
</pre>

</div>

<div class="section">
<h2>9. Validation Rules</h2>
<ul>
    <li>Only store changed fields</li>
    <li>Group changes per transaction</li>
    <li>Maintain version increment</li>
    <li>Financial calculations must match reserve/payment tables</li>
</ul>
</div>

<div class="section">
<h2>10. Final Definition</h2>
<div class="highlight">
ClaimChangeSet is a structured, transaction-level audit and event record 
that captures all operational and financial changes across claim-related tables, 
including calculated reserve and payment impacts.
</div>
</div>

</div>

</body>
</html>
